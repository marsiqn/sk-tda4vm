

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.1.1.2. USB Device Firmware Upgrade (DFU) &mdash; Processor SDK Linux for J721e Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Processor SDK Linux for J721e Documentation" href="../../../index.html"/>
        <link rel="up" title="3.1.1. User’s Guide" href="Users-Guide.html"/>
        <link rel="next" title="3.1.1.3. Network (Wired or USB Client)" href="UG-Network.html"/>
        <link rel="prev" title="3.1.1.1. General Information" href="UG-General-Info.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../../../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../devices/J7/linux/index.html" class="icon icon-home"> Processor SDK Linux for J721e
          

          
          </a>

          
            
            
              <div class="version">
                08_06_00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devices/J7/linux/Release_Specific.html">2. Release Specific</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../Foundational_Components.html">3. Foundational Components</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../Foundational_Components_U-Boot.html">3.1. U-Boot</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="Users-Guide.html">3.1.1. User’s Guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="UG-General-Info.html">3.1.1.1. General Information</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">3.1.1.2. USB Device Firmware Upgrade (DFU)</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-Network.html">3.1.1.3. Network (Wired or USB Client)</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-NAND.html">3.1.1.4. NAND</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-Memory.html">3.1.1.5. SD, eMMC and USB</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-SPI.html">3.1.1.6. SPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-QSPI.html">3.1.1.7. OSPI/QSPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-NOR.html">3.1.1.8. NOR</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-UART.html">3.1.1.9. UART</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-SATA.html">3.1.1.10. SATA</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-UFS.html">3.1.1.11. UFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-DDR3.html">3.1.1.12. DDR3 ECC</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-HyperBus.html">3.1.1.13. HyperBus and HyperFlash</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-RemoteProc.html">3.1.1.14. RemoteProc</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Applications.html">3.1.2. Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_Kernel.html">3.2. Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_Filesystem.html">3.3. Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_Tools.html">3.4. Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_IPCLLD.html">3.5. IPC Low Level Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_Graphics.html">3.6. Graphics and Display</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_Multimedia_D5520_VXE384.html">3.7. Multimedia Video Codec</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_Virtualization.html">3.8. Virtualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_ATF.html">3.9. ARM Trusted Firmware-A</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_OPTEE.html">3.10. OP-TEE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../How_to_Guides.html">4. How to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Documentation_Tarball.html">5. Documentation Tarball</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../devices/J7/linux/index.html">Processor SDK Linux for J721e</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../devices/J7/linux/index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../Foundational_Components.html">3. Foundational Components</a> &raquo;</li>
      
          <li><a href="../../Foundational_Components_U-Boot.html">3.1. U-Boot</a> &raquo;</li>
      
          <li><a href="Users-Guide.html">3.1.1. User’s Guide</a> &raquo;</li>
      
    <li>3.1.1.2. USB Device Firmware Upgrade (DFU)</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="usb-device-firmware-upgrade-dfu">
<span id="usb-device-firmware-upgrade-label"></span><h1>3.1.1.2. USB Device Firmware Upgrade (DFU)<a class="headerlink" href="#usb-device-firmware-upgrade-dfu" title="Permalink to this headline">¶</a></h1>
<p>When working with USB Device Firmware Upgrade (DFU), regardless of the
medium to be written to and of the board being used, there are some
general things to keep in mind. First of all, you will need to get a
copy of the <strong>dfu-util</strong> program installed on your host. If your
distribution does not provide this package you will need to build it
from source. Second, the examples that follow assume a single board is
plugged into the host PC. If you have more than one device plugged in
you will need to use the options that <strong>dfu-util</strong> provides for
specifying a single device to work with. Finally, to program via DFU for
a given storage device see the section for the storage device you are
working with.</p>
<div class="section" id="usb-peripheral-boot-mode-spl-dfu-support">
<h2>3.1.1.2.1. USB Peripheral boot mode (SPL-DFU support)<a class="headerlink" href="#usb-peripheral-boot-mode-spl-dfu-support" title="Permalink to this headline">¶</a></h2>
<p>The USB Peripheral boot mode is used to boot using USB
interface using SPL-DFU feature. Steps outlined here can be used on
platform that support USB Peripheral boot mode.</p>
<ol class="arabic simple">
<li>Enable the SPL-DFU feature in u-boot and build MLO/u-boot binaries.</li>
<li>Load the MLO and u-boot.img using the dfu-util from host PC.</li>
<li>Once the u-boot is up, use DFU command from u-boot to flash the
binary images from Host PC (using dfu-utils tool) to the eMMC, or
QSPI to fresh/factory boards.</li>
</ol>
<ul class="simple">
<li>Example provided here is for dra7xx platform.</li>
<li>Use default “dra7xx_evm_defconfig” to build spl/u-boot-spl.bin,
u-boot.img.</li>
</ul>
<div class="highlight-text"><div class="highlight"><pre><span></span>host$ make dra7xx_evm_defconfig
host$ make menuconfig

select SPL/DFU support
menuconfig-&gt;SPL/TPL---&gt;
   ..
   [*] Support booting from RAM
   [*] Support USB Gadget drivers
   [ ]    Support USB Ethernet drivers
   [*]    Support DFU (Device Firmware Upgrade)
             DFU device selection (RAM device) --&gt;
</pre></div>
</div>
<div class="highlight-text"><div class="highlight"><pre><span></span>Unselect CONFIG_HUSH_PARSER
menuconfig---&gt;Command Line interface
   [*] Support U-boot commands
   [ ]   Use hush shell
</pre></div>
</div>
<ul class="simple">
<li>Build spl/u-boot-spl.bin and u-boot.img</li>
</ul>
<div class="highlight-text"><div class="highlight"><pre><span></span>host$ make
</pre></div>
</div>
<p class="rubric">USB Peripheral boot mode on J721E EVM (SPL-DFU boot mode)</p>
<ul class="simple">
<li>Set SYSBOOT switches to USB Peripheral boot mode (Refer to <strong>Initialization</strong> chapter of J721E TRM for boot switch details)</li>
<li>Make sure USB0 port in UFP/DRP mode: SW3[3:4] = 01 or 1x</li>
<li>Connect EVM’s TypeC port (USB0 port) to PC through USB cable</li>
<li>Power on the board</li>
</ul>
<p class="rubric">On Linux host</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>host$ sudo dfu-util -l
</pre></div>
</div>
<p class="rubric">On Windows host</p>
<p>Download dfu-util from <em>Releases</em> section of <a class="reference external" href="http://dfu-util.sourceforge.net/">dfu-util Homepage</a> and extract the zip file.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>host&gt; dfu-util.exe -l
</pre></div>
</div>
<p>This will show the following DFU entities:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Found DFU: [0451:6163] ver=0200, devnum=50, cfg=1, intf=0, path=&quot;3-2&quot;, alt=1, name=&quot;SocId&quot;, serial=&quot;01.00.00.00&quot;
Found DFU: [0451:6163] ver=0200, devnum=50, cfg=1, intf=0, path=&quot;3-2&quot;, alt=0, name=&quot;bootloader&quot;, serial=&quot;01.00.00.00&quot;
</pre></div>
</div>
<p>Send boot images in this order: tiboot3.bin -&gt; sysfw.itb -&gt; tispl.bin -&gt; u-boot.img.</p>
<p>Move to directory containing the images and give the following commands</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>host$ sudo dfu-util -R -a bootloader -D tiboot3.bin
host$ sudo dfu-util -l
  Found DFU: [0451:6163] ver=0224, devnum=51, cfg=1, intf=0, path=&quot;3-2&quot;, alt=0, name=&quot;sysfw.itb&quot;, serial=&quot;UNKNOWN&quot;

host$ sudo dfu-util -R -a sysfw.itb -D sysfw.itb
host$ sudo dfu-util -l
  Found DFU: [0451:6163] ver=0224, devnum=52, cfg=1, intf=0, path=&quot;3-2&quot;, alt=1, name=&quot;u-boot.img&quot;, serial=&quot;UNKNOWN&quot;
  Found DFU: [0451:6163] ver=0224, devnum=52, cfg=1, intf=0, path=&quot;3-2&quot;, alt=0, name=&quot;tispl.bin&quot;, serial=&quot;UNKNOWN&quot;

host$ sudo dfu-util -R -a tispl.bin -D tispl.bin
host$ sudo dfu-util -R  -a u-boot.img -D u-boot.img
</pre></div>
</div>
<p>At this point, the board should boot to the U-Boot prompt.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This mode is not supported on J721E Rev E2 and earlier boards.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="UG-Network.html" class="btn btn-neutral float-right" title="3.1.1.3. Network (Wired or USB Client)" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="UG-General-Info.html" class="btn btn-neutral" title="3.1.1.1. General Information" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2021</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'08_06_00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>