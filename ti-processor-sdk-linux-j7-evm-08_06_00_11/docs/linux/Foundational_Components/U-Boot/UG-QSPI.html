

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.1.1.7. OSPI/QSPI &mdash; Processor SDK Linux for J721e Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Processor SDK Linux for J721e Documentation" href="../../../index.html"/>
        <link rel="up" title="3.1.1. User’s Guide" href="Users-Guide.html"/>
        <link rel="next" title="3.1.1.8. NOR" href="UG-NOR.html"/>
        <link rel="prev" title="3.1.1.6. SPI" href="UG-SPI.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../../../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../devices/J7/linux/index.html" class="icon icon-home"> Processor SDK Linux for J721e
          

          
          </a>

          
            
            
              <div class="version">
                08_06_00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devices/J7/linux/Release_Specific.html">2. Release Specific</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../Foundational_Components.html">3. Foundational Components</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../Foundational_Components_U-Boot.html">3.1. U-Boot</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="Users-Guide.html">3.1.1. User’s Guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="UG-General-Info.html">3.1.1.1. General Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-DFU.html">3.1.1.2. USB Device Firmware Upgrade (DFU)</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-Network.html">3.1.1.3. Network (Wired or USB Client)</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-NAND.html">3.1.1.4. NAND</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-Memory.html">3.1.1.5. SD, eMMC and USB</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-SPI.html">3.1.1.6. SPI</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">3.1.1.7. OSPI/QSPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-NOR.html">3.1.1.8. NOR</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-UART.html">3.1.1.9. UART</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-SATA.html">3.1.1.10. SATA</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-UFS.html">3.1.1.11. UFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-DDR3.html">3.1.1.12. DDR3 ECC</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-HyperBus.html">3.1.1.13. HyperBus and HyperFlash</a></li>
<li class="toctree-l4"><a class="reference internal" href="UG-RemoteProc.html">3.1.1.14. RemoteProc</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Applications.html">3.1.2. Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_Kernel.html">3.2. Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_Filesystem.html">3.3. Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_Tools.html">3.4. Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_IPCLLD.html">3.5. IPC Low Level Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_Graphics.html">3.6. Graphics and Display</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_Multimedia_D5520_VXE384.html">3.7. Multimedia Video Codec</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_Virtualization.html">3.8. Virtualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_ATF.html">3.9. ARM Trusted Firmware-A</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Foundational_Components_OPTEE.html">3.10. OP-TEE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../How_to_Guides.html">4. How to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Documentation_Tarball.html">5. Documentation Tarball</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../devices/J7/linux/index.html">Processor SDK Linux for J721e</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../devices/J7/linux/index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../Foundational_Components.html">3. Foundational Components</a> &raquo;</li>
      
          <li><a href="../../Foundational_Components_U-Boot.html">3.1. U-Boot</a> &raquo;</li>
      
          <li><a href="Users-Guide.html">3.1.1. User’s Guide</a> &raquo;</li>
      
    <li>3.1.1.7. OSPI/QSPI</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ospi-qspi">
<h1>3.1.1.7. OSPI/QSPI<a class="headerlink" href="#ospi-qspi" title="Permalink to this headline">¶</a></h1>
<p>OSPI/QSPI is a serial peripheral interface like SPI the major difference
being the support for Octal/Quad read, uses 8/4 data lines for read compared to
2 lines used by the traditional SPI. This section documents how to write
files to the QSPI device and use it to load and then boot the Linux
Kernel using a root filesystem also found on QSPI. At this time, no
special builds of U-Boot are required to perform these operations on the
supported hardware. For simplicity we assume the files are being loaded
from an SD card. Using the network interface (if applicable) is
documented above.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Not all OSPI flashes can be supported. Users are recommended to check
whether or not the OSPI flash part chosen for custom board designs meets all
the criteria listed at <a class="reference external" href="https://e2e.ti.com/support/processors/f/791/t/946418">https://e2e.ti.com/support/processors/f/791/t/946418</a></p>
</div>
<p>ROM supports booting from OSPI from offset 0x0.</p>
<p><strong>Flashing Images to OSPI</strong></p>
<p>Below commands can be used to download tiboot3.bin, tispl.bin and
u-boot.img over tftp and then flash it to OSPI at respective addresses.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">=&gt; sf probe</span>
<span class="go">=&gt; tftp ${loadaddr} tiboot3.bin</span>
<span class="go">=&gt; sf update $loadaddr 0x0 $filesize</span>
<span class="go">=&gt; tftp ${loadaddr} tispl.bin</span>
<span class="go">=&gt; sf update $loadaddr 0x80000 $filesize</span>
<span class="go">=&gt; tftp ${loadaddr} u-boot.img</span>
<span class="go">=&gt; sf update $loadaddr 0x280000 $filesize</span>
<span class="go">=&gt; tftp ${loadaddr} sysfw.itb</span>
<span class="go">=&gt; sf update $loadaddr 0x6C0000 $filesize</span>
</pre></div>
</div>
<p><strong>PHY Calibration</strong></p>
<p>PHY calibration allows for higher read performance. To enable PHY, the PHY
calibration pattern must be flashed to OSPI at the start of the last erase
sector. For the Micron MT35XU512ABA flash, this lies at the address 0x3fe0000.</p>
<p>Download the binary file containing the PHY pattern from <a class="reference download internal" href="../../../_downloads/ospi_phy_pattern" download=""><code class="xref download docutils literal"><span class="pre">here</span></code></a>.
Below commands can be used to flash the PHY pattern, with the location of the
pattern depending on which flash is being used:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">=&gt; sf probe</span>
<span class="go">=&gt; tftp ${loadaddr} ospi_phy_pattern</span>
<span class="go">=&gt; sf update $loadaddr 0x3fe0000 $filesize</span>
</pre></div>
</div>
<p><strong>Flash Layout for OSPI</strong></p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">      0x0 +----------------------------+</span>
<span class="go">          |     ospi.tiboot3(512K)     |</span>
<span class="go">          |                            |</span>
<span class="go">  0x80000 +----------------------------+</span>
<span class="go">          |     ospi.tispl(2M)         |</span>
<span class="go">          |                            |</span>
<span class="go"> 0x280000 +----------------------------+</span>
<span class="go">          |     ospi.u-boot(4M)        |</span>
<span class="go">          |                            |</span>
<span class="go"> 0x680000 +----------------------------+</span>
<span class="go">          |     ospi.env(128K)         |</span>
<span class="go">          |                            |</span>
<span class="go"> 0x6A0000 +----------------------------+</span>
<span class="go">          |   ospi.env.backup (128K)   |</span>
<span class="go">          |                            |</span>
<span class="go"> 0x6C0000 +----------------------------+</span>
<span class="go">          |      ospi.sysfw(1M)        |</span>
<span class="go">          |                            |</span>
<span class="go"> 0x7C0000 +----------------------------+</span>
<span class="go">          |      padding (256k)        |</span>
<span class="go"> 0x800000 +----------------------------+</span>
<span class="go">          |     ospi.rootfs(UBIFS)     |</span>
<span class="go">          |                            |</span>
<span class="go">0x3FE0000 +----------------------------+</span>
<span class="go">          |   ospi.phypattern (128k)   |</span>
<span class="go">          |                            |</span>
<span class="go">          +----------------------------+</span>
</pre></div>
</div>
<p>Kernel Image and DT are expected to be present in the /boot folder of UBIFS
ospi.rootfs just like in SD card case. U-Boot looks for UBI volume named
“rootfs” for rootfs.</p>
<p>To boot kernel from OSPI, at the U-Boot prompt:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">=&gt; setenv boot ubi</span>
<span class="go">=&gt; boot</span>
</pre></div>
</div>
<p><strong>Writing to OSPI using DFU</strong></p>
<p>Setup: Connect the Type C port (USB0 port) of EVM to ubuntu host PC. Make sure
dfu-util tool is installed and USB0 port is in UFP/DRP mode: SW3[3:4] = 01 or 1x.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>#sudo apt-get install dfu-util
</pre></div>
</div>
<p>From u-boot(for OSPI flash):</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>U-Boot # env default -a
U-Boot # setenv dfu_alt_info ${dfu_alt_info_ospi}; dfu 0 sf &quot;0:0:25000000:0&quot;
</pre></div>
</div>
<p>From u-boot(for QSPI flash):</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>U-Boot # env default -a
U-Boot # setenv dfu_alt_info ${dfu_alt_info_ospi}; dfu 0 sf &quot;1:0:40000000:0&quot;
</pre></div>
</div>
<p>From ubuntu PC: Using dfu-util utilities to flash the binares to OSPI/QSPI flash.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span># sudo dfu-util -l
Copyright 2005-2009 Weston Schmidt, Harald Welte and OpenMoko Inc.
Copyright 2010-2016 Tormod Volden and Stefan Schmidt
This program is Free Software and has ABSOLUTELY NO WARRANTY
Found DFU: [0451:6163] ver=0224, devnum=75, cfg=1, intf=0, path=&quot;1-5&quot;, alt=5, name=&quot;rootfs&quot;, serial=&quot;0000000000000110&quot;
Found DFU: [0451:6163] ver=0224, devnum=75, cfg=1, intf=0, path=&quot;1-5&quot;, alt=4, name=&quot;sysfw.itb&quot;, serial=&quot;0000000000000110&quot;
Found DFU: [0451:6163] ver=0224, devnum=75, cfg=1, intf=0, path=&quot;1-5&quot;, alt=3, name=&quot;u-boot-env&quot;, serial=&quot;0000000000000110&quot;
Found DFU: [0451:6163] ver=0224, devnum=75, cfg=1, intf=0, path=&quot;1-5&quot;, alt=2, name=&quot;u-boot.img&quot;, serial=&quot;0000000000000110&quot;
Found DFU: [0451:6163] ver=0224, devnum=75, cfg=1, intf=0, path=&quot;1-5&quot;, alt=1, name=&quot;tispl.bin&quot;, serial=&quot;0000000000000110&quot;
Found DFU: [0451:6163] ver=0224, devnum=75, cfg=1, intf=0, path=&quot;1-5&quot;, alt=0, name=&quot;tiboot3.bin&quot;, serial=&quot;0000000000000110&quot;&quot;
</pre></div>
</div>
<p>Flash the binaries to the respective regions using alternate interface
number (alt=&lt;x&gt;).</p>
<div class="highlight-text"><div class="highlight"><pre><span></span># sudo dfu-util -c 1 -i 0 -a 0 -D tiboot3.bin
# sudo dfu-util -c 1 -i 0 -a 1 -D tispl.bin
# sudo dfu-util -c 1 -i 0 -a 2 -D u-boot.img
# sudo dfu-util -c 1 -i 0 -a 3 -D sysfw.itb
</pre></div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="UG-NOR.html" class="btn btn-neutral float-right" title="3.1.1.8. NOR" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="UG-SPI.html" class="btn btn-neutral" title="3.1.1.6. SPI" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2021</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'08_06_00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>