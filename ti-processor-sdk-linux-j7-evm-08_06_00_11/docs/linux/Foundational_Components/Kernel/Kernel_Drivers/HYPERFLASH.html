

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.2.2.8. HyperBus and HyperFlash &mdash; Processor SDK Linux for J721e Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="Processor SDK Linux for J721e Documentation" href="../../../../index.html"/>
        <link rel="up" title="3.2.2. Kernel Drivers" href="../../../Foundational_Components_Kernel_Drivers.html"/>
        <link rel="next" title="3.2.2.9. I2C" href="I2C.html"/>
        <link rel="prev" title="3.2.2.7. GPIO" href="GPIO.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../../../../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../devices/J7/linux/index.html" class="icon icon-home"> Processor SDK Linux for J721e
          

          
          </a>

          
            
            
              <div class="version">
                08_06_00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devices/J7/linux/Release_Specific.html">2. Release Specific</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../Foundational_Components.html">3. Foundational Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_U-Boot.html">3.1. U-Boot</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../Foundational_Components_Kernel.html">3.2. Kernel</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../Foundational_Components_Kernel_Users_Guide.html">3.2.1. Users Guide</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../Foundational_Components_Kernel_Drivers.html">3.2.2. Kernel Drivers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="ADC.html">3.2.2.1. ADC</a></li>
<li class="toctree-l4"><a class="reference internal" href="Audio.html">3.2.2.2. Audio</a></li>
<li class="toctree-l4"><a class="reference internal" href="Camera/CSI2RX.html">3.2.2.3. CSI2RX</a></li>
<li class="toctree-l4"><a class="reference internal" href="Crypto.html">3.2.2.4. Crypto</a></li>
<li class="toctree-l4"><a class="reference internal" href="MCAN.html">3.2.2.5. MCAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="Display/DSS7.html">3.2.2.6. DSS</a></li>
<li class="toctree-l4"><a class="reference internal" href="GPIO.html">3.2.2.7. GPIO</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">3.2.2.8. HyperBus and HyperFlash</a></li>
<li class="toctree-l4"><a class="reference internal" href="I2C.html">3.2.2.9. I2C</a></li>
<li class="toctree-l4"><a class="reference internal" href="Network/CPSW-Ethernet.html">3.2.2.10. CPSW Ethernet</a></li>
<li class="toctree-l4"><a class="reference internal" href="PCIe/PCIe_End_Point.html">3.2.2.11. PCIe End Point</a></li>
<li class="toctree-l4"><a class="reference internal" href="PCIe/PCIe_Backplane.html">3.2.2.12. PCIe Backplane</a></li>
<li class="toctree-l4"><a class="reference internal" href="PCIe/PCIe_Root_Complex.html">3.2.2.13. PCIe Root Complex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Foundational_Components_Kernel_Drivers_Power_Management.html">3.2.2.14. Power Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="QSPI.html">3.2.2.15. OSPI/QSPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="SERDES/SERDES.html">3.2.2.16. SERDES</a></li>
<li class="toctree-l4"><a class="reference internal" href="SPI.html">3.2.2.17. SPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="Storage/NAND.html">3.2.2.18. NAND</a></li>
<li class="toctree-l4"><a class="reference internal" href="Storage/MMC-SD.html">3.2.2.19. MMC/SD</a></li>
<li class="toctree-l4"><a class="reference internal" href="UART.html">3.2.2.20. UART</a></li>
<li class="toctree-l4"><a class="reference internal" href="UFS.html">3.2.2.21. UFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="USB/CDNS3.html">3.2.2.22. USB</a></li>
<li class="toctree-l4"><a class="reference internal" href="VTM.html">3.2.2.23. Voltage &amp; Thermal Management (VTM)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Foundational_Components_Kernel_LTP-DDT_Validation.html">3.2.3. LTP-DDT Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Foundational_Components_Kernel_FAQs.html">3.2.4. FAQs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_Filesystem.html">3.3. Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_Tools.html">3.4. Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_IPCLLD.html">3.5. IPC Low Level Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_Graphics.html">3.6. Graphics and Display</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_Multimedia_D5520_VXE384.html">3.7. Multimedia Video Codec</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_Virtualization.html">3.8. Virtualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_ATF.html">3.9. ARM Trusted Firmware-A</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_OPTEE.html">3.10. OP-TEE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../How_to_Guides.html">4. How to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Documentation_Tarball.html">5. Documentation Tarball</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../devices/J7/linux/index.html">Processor SDK Linux for J721e</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../devices/J7/linux/index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../Foundational_Components.html">3. Foundational Components</a> &raquo;</li>
      
          <li><a href="../../../Foundational_Components_Kernel.html">3.2. Kernel</a> &raquo;</li>
      
          <li><a href="../../../Foundational_Components_Kernel_Drivers.html">3.2.2. Kernel Drivers</a> &raquo;</li>
      
    <li>3.2.2.8. HyperBus and HyperFlash</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="hyperbus-and-hyperflash">
<h1>3.2.2.8. HyperBus and HyperFlash<a class="headerlink" href="#hyperbus-and-hyperflash" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>3.2.2.8.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>HyperBus is Low Signal Count, High Performance Double Data Rate (DDR) Bus interface between a host system master and one or more slave interfaces. Its a 8-bit data bus (DQ[7:0]) with  Read-Write Data Strobe (RWDS) signal and either Single-ended clock(3.0V parts) or Differential clock (1.8V parts). It uses ChipSelect lines to select b/w multiple slaves. At bus level, it follows a separate protocol described in HyperBus specification.</p>
<p>HyperFlash is a NOR flash based device storage over HyperBus.  HyperFlash follows CFI AMD/Fujitsu Extended Command Set (0x0002) similar to that of existing parallel NORs. Since Hyperbus is x8 DDR bus, its equivalent to x16 parallel NOR flash wrt bits per clk. But Hyperbus operates at much higher frequencies.</p>
<p>HyperFlash on TI’s J7 EVM is connected to HyperBus Memory Controller that supports memory mapped IO access to flash. HyperFlash is supported under kernel’s MTD framework.</p>
<p><strong>Supported Devices</strong></p>
<ul class="simple">
<li>J7200 EVM</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On J7200 EVM, switch SW3.1 should be in ON position at the time
of powering on the board to access HyperFlash.</p>
</div>
</div>
<div class="section" id="driver-architecture">
<h2>3.2.2.8.2. Driver Architecture<a class="headerlink" href="#driver-architecture" title="Permalink to this headline">¶</a></h2>
<p>Following diagram shows the HyperBus and HyperFlash driver stack:</p>
<div class="figure">
<img alt="../../../../_images/hbmc-linux-arch.png" src="../../../../_images/hbmc-linux-arch.png" />
</div>
<p><strong>Source Location</strong></p>
<p>The source file for the HyperBus controller driver can be found at: drivers/mtd/hyperbus/hbmc-am654.c under Linux Kernel source tree.</p>
<p>HyperFlash command set is implementation is at: drivers/mtd/chips/cfi_cmdset0002.c</p>
<div class="section" id="kernel-configuration-options">
<h3>3.2.2.8.2.1. Kernel Configuration Options<a class="headerlink" href="#kernel-configuration-options" title="Permalink to this headline">¶</a></h3>
<p>The driver can be built into the kernel or can be compiled as module and
loaded into the kernel dynamically.</p>
<p><strong>Enabling HyperBus driver</strong></p>
<p>Following configs are to be enabled for HyperBus and HyperFlash.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">HyperBus driver and their dependencies are enabled by default in
the SDK images. So this section can be skipped in that case.</p>
</div>
<p>Start the Linux Kernel Configuration tool:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ make menuconfig  ARCH=arm64
</pre></div>
</div>
<div class="highlight-text"><div class="highlight"><pre><span></span>Device Drivers  ---&gt;
  &lt;*&gt; Memory Technology Device (MTD) support  ---&gt;
    &lt;*&gt;  HyperBus support  ---&gt;
       &lt;*&gt;   HyperBus controller driver for AM65x SoC
</pre></div>
</div>
<p>Enabling UBIFS filesystem support:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>File systems  ---&gt;
  [*] Miscellaneous filesystems  ---&gt;
    &lt;*&gt;   UBIFS file system support
</pre></div>
</div>
</div>
<div class="section" id="dt-configuration">
<h3>3.2.2.8.2.2. DT Configuration<a class="headerlink" href="#dt-configuration" title="Permalink to this headline">¶</a></h3>
<p>Refer to Documentation/devicetree/bindings/mtd/ti,am654-hbmc.txt
kernel source tree for HyperBus and HyperFlash documentation driver’s DT bindings and
their usage. Example DT entry:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>fss: system-controller@47000000 {
        compatible = &quot;syscon&quot;, &quot;simple-mfd&quot;;
        reg = &lt;0x0 0x47000000 0x0 0x100&gt;;
        #address-cells = &lt;2&gt;;
        #size-cells = &lt;2&gt;;
        ranges;

        hbmc_mux: hbmc-mux {
                compatible = &quot;mmio-mux&quot;;
                #mux-control-cells = &lt;1&gt;;
                mux-reg-masks = &lt;0x4 0x2&gt;; /* HBMC select */
        };

        hbmc: hyperbus@47034000 {
                compatible = &quot;ti,am654-hbmc&quot;;
                reg = &lt;0x0 0x47034000 0x0 0x100&gt;,
                        &lt;0x5 0x00000000 0x1 0x0000000&gt;;
                power-domains = &lt;&amp;k3_pds 102 TI_SCI_PD_EXCLUSIVE&gt;;
                clocks = &lt;&amp;k3_clks 102 0&gt;;
                assigned-clocks = &lt;&amp;k3_clks 102 5&gt;;
                assigned-clock-rates = &lt;333333333&gt;;
                #address-cells = &lt;2&gt;;
                #size-cells = &lt;1&gt;;
                mux-controls = &lt;&amp;hbmc_mux 0&gt;;
        };
};

&amp;hbmc {
        pinctrl-names = &quot;default&quot;;
        pinctrl-0 = &lt;&amp;mcu_fss0_hpb0_pins_default&gt;;
        ranges = &lt;0x0 0x0 0x5 0x00000000 0x4000000&gt;, /* 64MB Flash on CS0 */
                 &lt;0x1 0x0 0x5 0x04000000 0x800000&gt;; /* 8MB RAM on CS1 */

        flash@0,0 {
                compatible = &quot;cypress,hyperflash&quot;, &quot;cfi-flash&quot;;
                reg = &lt;0x0 0x0 0x4000000&gt;;
        };
};
</pre></div>
</div>
</div>
<div class="section" id="driver-usage">
<h3>3.2.2.8.2.3. Driver Usage<a class="headerlink" href="#driver-usage" title="Permalink to this headline">¶</a></h3>
<p>HyperFlash is exposed to userspace as MTD character devices and
/dev/mtdX (X = 0, 1, 2) entries are created for every partition defined
in DT or via command line arguments. MTD abstracts all types of flashes
and, To see all MTD partitions in the system run:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$cat /proc/mtd
</pre></div>
</div>
<p>Here is example for <a class="reference external" href="https://www.kernel.org/doc/Documentation/devicetree/bindings/mtd/partition.txt">DT partitioning</a>.
Example for passing <a class="reference external" href="https://www.denx.de/wiki/view/DULG/BootTimeConfigurationOfMTDPartitions">cmdline partition from U-Boot</a>.</p>
</div>
<div class="section" id="testing">
<h3>3.2.2.8.2.4. Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h3>
<p>Since, HyperFlash is supported under MTD framework, usage is same as
SPI NOR flashes such as OSPI/QSPI. HyperFlash also supports UBIFS as
filesystem format. Note that, it is necessary to define at least one
cmdline or DT partition to use UBIFS.</p>
<p>Refer to <a class="reference internal" href="QSPI.html#testing-kernel-qspi-label"><span class="std std-ref">QSPI section for more testing</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently, Linux has no support for HyperRAM.</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="I2C.html" class="btn btn-neutral float-right" title="3.2.2.9. I2C" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="GPIO.html" class="btn btn-neutral" title="3.2.2.7. GPIO" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2021</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'08_06_00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>