

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.2.2.14.1. DFS &mdash; Processor SDK Linux for J721e Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../search.html"/>
    <link rel="top" title="Processor SDK Linux for J721e Documentation" href="../../../../../index.html"/>
        <link rel="up" title="3.2.2.14. Power Management" href="../../../../Foundational_Components_Kernel_Drivers_Power_Management.html"/>
        <link rel="next" title="3.2.2.15. OSPI/QSPI" href="../QSPI.html"/>
        <link rel="prev" title="3.2.2.14. Power Management" href="../../../../Foundational_Components_Kernel_Drivers_Power_Management.html"/> 

  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../../../../../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../devices/J7/linux/index.html" class="icon icon-home"> Processor SDK Linux for J721e
          

          
          </a>

          
            
            
              <div class="version">
                08_06_00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../devices/J7/linux/Release_Specific.html">2. Release Specific</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../Foundational_Components.html">3. Foundational Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../Foundational_Components_U-Boot.html">3.1. U-Boot</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../Foundational_Components_Kernel.html">3.2. Kernel</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../../Foundational_Components_Kernel_Users_Guide.html">3.2.1. Users Guide</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../../Foundational_Components_Kernel_Drivers.html">3.2.2. Kernel Drivers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../ADC.html">3.2.2.1. ADC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Audio.html">3.2.2.2. Audio</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Camera/CSI2RX.html">3.2.2.3. CSI2RX</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Crypto.html">3.2.2.4. Crypto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../MCAN.html">3.2.2.5. MCAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Display/DSS7.html">3.2.2.6. DSS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../GPIO.html">3.2.2.7. GPIO</a></li>
<li class="toctree-l4"><a class="reference internal" href="../HYPERFLASH.html">3.2.2.8. HyperBus and HyperFlash</a></li>
<li class="toctree-l4"><a class="reference internal" href="../I2C.html">3.2.2.9. I2C</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Network/CPSW-Ethernet.html">3.2.2.10. CPSW Ethernet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../PCIe/PCIe_End_Point.html">3.2.2.11. PCIe End Point</a></li>
<li class="toctree-l4"><a class="reference internal" href="../PCIe/PCIe_Backplane.html">3.2.2.12. PCIe Backplane</a></li>
<li class="toctree-l4"><a class="reference internal" href="../PCIe/PCIe_Root_Complex.html">3.2.2.13. PCIe Root Complex</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../../../Foundational_Components_Kernel_Drivers_Power_Management.html">3.2.2.14. Power Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../QSPI.html">3.2.2.15. OSPI/QSPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../SERDES/SERDES.html">3.2.2.16. SERDES</a></li>
<li class="toctree-l4"><a class="reference internal" href="../SPI.html">3.2.2.17. SPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Storage/NAND.html">3.2.2.18. NAND</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Storage/MMC-SD.html">3.2.2.19. MMC/SD</a></li>
<li class="toctree-l4"><a class="reference internal" href="../UART.html">3.2.2.20. UART</a></li>
<li class="toctree-l4"><a class="reference internal" href="../UFS.html">3.2.2.21. UFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../USB/CDNS3.html">3.2.2.22. USB</a></li>
<li class="toctree-l4"><a class="reference internal" href="../VTM.html">3.2.2.23. Voltage &amp; Thermal Management (VTM)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Foundational_Components_Kernel_LTP-DDT_Validation.html">3.2.3. LTP-DDT Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Foundational_Components_Kernel_FAQs.html">3.2.4. FAQs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Foundational_Components_Filesystem.html">3.3. Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Foundational_Components_Tools.html">3.4. Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Foundational_Components_IPCLLD.html">3.5. IPC Low Level Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Foundational_Components_Graphics.html">3.6. Graphics and Display</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Foundational_Components_Multimedia_D5520_VXE384.html">3.7. Multimedia Video Codec</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Foundational_Components_Virtualization.html">3.8. Virtualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Foundational_Components_ATF.html">3.9. ARM Trusted Firmware-A</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Foundational_Components_OPTEE.html">3.10. OP-TEE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../How_to_Guides.html">4. How to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Documentation_Tarball.html">5. Documentation Tarball</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../../devices/J7/linux/index.html">Processor SDK Linux for J721e</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../../devices/J7/linux/index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../../Foundational_Components.html">3. Foundational Components</a> &raquo;</li>
      
          <li><a href="../../../../Foundational_Components_Kernel.html">3.2. Kernel</a> &raquo;</li>
      
          <li><a href="../../../../Foundational_Components_Kernel_Drivers.html">3.2.2. Kernel Drivers</a> &raquo;</li>
      
          <li><a href="../../../../Foundational_Components_Kernel_Drivers_Power_Management.html">3.2.2.14. Power Management</a> &raquo;</li>
      
    <li>3.2.2.14.1. DFS</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dfs">
<h1>3.2.2.14.1. DFS<a class="headerlink" href="#dfs" title="Permalink to this headline">¶</a></h1>
<p class="rubric">Overview</p>
<p>Dynamic frequency scaling (DFS) is the ability of a part to modify
frequency it operates at based on need, user preference, or other
factors. MPU DFS is supported in the kernel by the cpufreq driver. All
supported SoCs use the generic cpufreq driver. The frequency at which
the MPU operates is selected by a driver called a governor. Each
governor has a different strategy for selecting the most appropriate
frequency. The following governors are available within the kernel:</p>
<ul class="simple">
<li><strong>ondemand</strong>: This governor samples the load of the cpu and scales it
up aggressively in order to provide the proper amount of processing
power.</li>
<li><strong>conservative</strong>: This governor is similar to ondemand but uses a
less aggressive method of increasing the the OPP of the MPU.</li>
<li><strong>performance</strong>: This governor statically sets the OPP of the MPU to
the highest possible frequency.</li>
<li><strong>powersave</strong>: This governor statically sets the OPP of the MPU to
the lowest possible frequency.</li>
<li><strong>userspace</strong>: This governor allows the user to set the desired OPP
using any value found within scaling_available_frequencies by
echoing it into scaling_setspeed.</li>
</ul>
<p>More in depth documentation about each governor can be found in the
linux kernel documentation here:
<a class="reference external" href="https://www.kernel.org/doc/Documentation/cpu-freq/governors.txt">https://www.kernel.org/doc/Documentation/cpu-freq/governors.txt</a></p>
<p>By default, cpufreq, the cpufreq driver, and all of the standard
governors are enabled with the ondemand governor selected as the default
governor. To make changes, follow the instructions below.</p>
<p class="rubric">Source Location</p>
<p>drivers/cpufreq/cpufreq-dt.c</p>
<p>The OPP data itself is used by the cpufreq DT driver to scale frequencies
based on the governors.</p>
<p class="rubric">Kernel Configuration Options</p>
<p>The driver can be built into the kernel as a static module, dynamic
module, or both.</p>
<p>$ make menuconfig</p>
<p>Select CPU Power Management from the main menu.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>...
...
Boot options ---&gt;
CPU Power Management ---&gt;
Floating point emulation ---&gt;
...
</pre></div>
</div>
<p>Select CPU Frequency Scaling as shown here:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>...
...
    CPU Frequency Scaling ---&gt;
[*] CPU idle PM support
...
</pre></div>
</div>
<p>All relevant options are listed below:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span> [*] CPU Frequency scaling
 &lt;*&gt;   CPU frequency translation statistics
 [*]     CPU frequency translation statistics details
       Default CPUFreq governor (userspace)  ---&gt;
 &lt;*&gt;   &#39;performance&#39; governor
 &lt;*&gt;   &#39;powersave&#39; governor
 -*-   &#39;userspace&#39; governor for userspace frequency scaling
 &lt;*&gt;   &#39;ondemand&#39; cpufreq policy governor
 &lt;*&gt;   &#39;conservative&#39; cpufreq governor
       *** CPU frequency scaling drivers ***
 &lt;M&gt;   Generic DT based cpufreq driver
 &lt;M&gt;   Generic DT based cpufreq driver using clk notifiers
 &lt;*&gt;    Texas Instruments CPUFreq support
...
</pre></div>
</div>
<p class="rubric">DT Configuration</p>
<p>The clock information and the operating-points table need to be added as
given in the example below.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>/* From arch/arm64/boot/dts/ti/k3-j7200.dtsi */

cpus {
            #address-cells = &lt;1&gt;;
            #size-cells = &lt;0&gt;;
            cpu-map {
                    cluster0: cluster0 {
                            core0 {
                                    cpu = &lt;&amp;cpu0&gt;;
                            };

                            core1 {
                                    cpu = &lt;&amp;cpu1&gt;;
                            };
                    };

            };

            cpu0: cpu@0 {
                    compatible = &quot;arm,cortex-a72&quot;;
                    reg = &lt;0x000&gt;;
                    device_type = &quot;cpu&quot;;
                    enable-method = &quot;psci&quot;;
                    i-cache-size = &lt;0xc000&gt;;
                    i-cache-line-size = &lt;64&gt;;
                    i-cache-sets = &lt;256&gt;;
                    d-cache-size = &lt;0x8000&gt;;
                    d-cache-line-size = &lt;64&gt;;
                    d-cache-sets = &lt;256&gt;;
                    next-level-cache = &lt;&amp;L2_0&gt;;
                    clocks = &lt;&amp;k3_clks 202 2&gt;;
                    clock-names = &quot;cpu&quot;;
                    operating-points-v2 = &lt;&amp;cpu0_opp_table&gt;;
                    #cooling-cells = &lt;2&gt;; /* min followed by max */
            };

            cpu1: cpu@1 {
                    compatible = &quot;arm,cortex-a72&quot;;
                    reg = &lt;0x001&gt;;
                    device_type = &quot;cpu&quot;;
                    enable-method = &quot;psci&quot;;
                    i-cache-size = &lt;0xc000&gt;;
                    i-cache-line-size = &lt;64&gt;;
                    i-cache-sets = &lt;256&gt;;
                    d-cache-size = &lt;0x8000&gt;;
                    d-cache-line-size = &lt;64&gt;;
                    d-cache-sets = &lt;256&gt;;
                    next-level-cache = &lt;&amp;L2_0&gt;;
                    operating-points-v2 = &lt;&amp;cpu0_opp_table&gt;;
                    #cooling-cells = &lt;2&gt;; /* min followed by max */
                    clocks = &lt;&amp;k3_clks 203 0&gt;;
                    clock-names = &quot;cpu&quot;;
            };
    };
</pre></div>
</div>
<p class="rubric">Driver Usage</p>
<p>All of the standard governors are built-in to the kernel, and by default
the performance governor is selected. Performance governor sets the CPU
statically to the highest frequency within the borders of scaling_min_freq
and scaling_max_freq.</p>
<p>To view available governors,</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors
conservative userspace powersave ondemand performance
</pre></div>
</div>
<p>To view current governor,</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
ondemand
</pre></div>
</div>
<p>To set a governor,</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ echo userspace &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
</pre></div>
</div>
<p>To view current OPP (frequency in kHz)</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq
2000000000
</pre></div>
</div>
<p>To view supported OPP’s (frequency in kHz),</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies
750000000 1000000000 1500000000 2000000000
</pre></div>
</div>
<p>To change OPP (can be done only for userspace governor. If governors
like ondemand is used, OPP change happens automatically based on the
system load)</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ echo 1000000000 &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_setspeed
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="operating-points">Operating Points</p>
<p>Design: OPP term is derived from the usage in DVFS where they are a
pair of voltage frequency value. To keep compatibility with the DVFS
system, DFS uses same OPP tables with the voltages removed from the
table.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>/* From arch/arm64/boot/dts/ti/k3-j7200.dtsi */

    cpu0_opp_table: opp-table {
            compatible = &quot;operating-points-v2&quot;;

            opp4-2000000000 {
                    opp-hz = /bits/ 64 &lt;2000000000&gt;;
            };

            opp3-1500000000 {
                    opp-hz = /bits/ 64 &lt;1500000000&gt;;
            };

            opp2-1000000000 {
                    opp-hz = /bits/ 64 &lt;1000000000&gt;;
            };

            opp1-750000000 {
                    opp-hz = /bits/ 64 &lt;750000000&gt;;
            };
    };
</pre></div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../QSPI.html" class="btn btn-neutral float-right" title="3.2.2.15. OSPI/QSPI" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../../../Foundational_Components_Kernel_Drivers_Power_Management.html" class="btn btn-neutral" title="3.2.2.14. Power Management" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2021</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'08_06_00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>